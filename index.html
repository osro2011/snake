<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title></title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <script src="http://koda.nu/simple.js">
            class Coordinate {
                constructor(X, Y) {
                    this.x = X;
                    this.y = Y;
                }
            }

            class Square {
                constructor(X, Y, Size, Color = "lightgray") {
                    this.coordinates = new Coordinate(X, Y);
                    this.size = Size;
                    this.color = Color;
                }
            }

            class Gamespace {
                constructor(Bounds, SquareSize, Gap, SquareColor = "lightgray") {
                    this.bounds = Bounds;
                    this.squareSize = SquareSize;
                    this.gap = Gap;
                    this.squareColor = SquareColor;
                    this.gameOver = false;

                    this.extraSpace = {
                        x: this.bounds.width % (this.squareSize + this.gap),
                        y: this.bounds.height % (this.squareSize + this.gap)
                    };

                    this.maxX = (this.bounds.width - this.extraSpace.x) / (this.squareSize + this.gap);
                    this.maxY = (this.bounds.height - this.extraSpace.y) / (this.squareSize + this.gap);

                    this.squares = [];
                    for (var x = 0; x < this.maxX; x++) {
                        this.squares.push([]);
                        for (var y = 0; y < this.maxY; y++) {
                            this.squares[x].push(new Square(this.extraSpace.x/2 + x * (this.squareSize + this.gap), this.extraSpace.y/2 + y * (this.squareSize + this.gap), this.squareSize, this.squareColor));
                        }
                    } 
                    this.drawSquares();
                }

                getSquare(coordinate) {
                    return this.squares[coordinate.x][coordinate.y];
                }

                drawSquares() {
                    if (!this.gameOver) {
                        for (var x = 0; x < this.squares.length; x++) {
                            for (var y = 0; y < this.squares[x].length; y++) {
                                rectangle(this.getSquare({x, y}).coordinates.x, this.getSquare({x, y}).coordinates.y, this.getSquare({x, y}).size, this.getSquare({x, y}).size, this.getSquare({x, y}).color);
                            }
                        } 
                    }
                }

                endGame() {
                    this.gameOver = true;
                    console.log("haha fuckwad you lost");
                }
            }

            class Snake {
                constructor(X, Y, Gamespace, Color = "Black", Size = 1) {
                    this.coordinates = [new Coordinate(X, Y)];new Coordinate(X, Y)
                    this.gamespace = Gamespace; 
                    this.color = Color;
                    this.size = Size;

                    this.drawSnake();
                }

                moveSnake(x, y) {
                    this.coordinates.unshift(new Coordinate(this.coordinates[0].x + x, this.coordinates[0].y + y));
                    if (this.coordinates.length > this.size) {
                        var undraw = this.coordinates.pop();
                        this.gamespace.getSquare(new Coordinate(0, 0));
                        this.gamespace.getSquare(undraw).color = this.gamespace.squareColor;
                    }

                    this.drawSnake();
                }

                drawSnake() {
                    for (var draw of this.coordinates) {
                        this.gamespace.getSquare(draw).color = this.color;
                    }
                }

                // Förflyttning av ormen
                // Håll koll på vart ormen är
                // Kollisioner med orm och äpple
                
            }

            class Apple {
                constructor(Gamespace) {
                    this.gamespace = Gamespace;
                    this.coordinates = new Coordinate(random(0, this.gamespace.maxX - 1), random(0, this.gamespace.maxY - 1))

                    this.gamespace.squares[this.coordinates.x][this.coordinates.y].color = "red";
                }
            }

            canvas = document.getElementById("canvas");
			bounds = {
				height: canvas.height,
				width: canvas.width
			}

            var space = new Gamespace(bounds, 20, 2);
            var snake = new Snake(0, 0, space, "black", 5);
            var apple = new Apple(space);


            function update() {
                clearScreen();
                space.drawSquares();
                snake.moveSnake(1, 0);
            }
        </script>
    </body>
</html>
